<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explore - 3D Room</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            overflow: hidden;
            background: #1a1a2e;
        }

        #info {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px;
            text-align: center;
            color: white;
            background: rgba(0, 0, 0, 0.7);
            z-index: 100;
            transition: opacity 0.5s;
        }

        #info h1 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        #info p {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        #crosshair {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            pointer-events: none;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s;
        }

        #crosshair::before,
        #crosshair::after {
            content: '';
            position: absolute;
            background: white;
            border-radius: 1px;
        }

        #crosshair::before {
            width: 2px;
            height: 20px;
            left: 9px;
            top: 0;
        }

        #crosshair::after {
            width: 20px;
            height: 2px;
            left: 0;
            top: 9px;
        }

        #tooltip {
            position: fixed;
            top: 60%;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            background: rgba(37, 99, 235, 0.9);
            color: white;
            border-radius: 8px;
            font-size: 1rem;
            pointer-events: none;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s;
        }

        #loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #1a1a2e;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 1000;
        }

        #loading h2 {
            margin-bottom: 1rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #back-link {
            position: fixed;
            bottom: 20px;
            left: 20px;
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            background: rgba(0,0,0,0.5);
            border-radius: 8px;
            z-index: 100;
            font-size: 0.9rem;
            transition: background 0.3s;
        }

        #back-link:hover {
            background: rgba(37, 99, 235, 0.8);
        }

        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <div id="loading">
        <h2>Entering the room...</h2>
        <div class="spinner"></div>
    </div>

    <div id="info">
        <h1>Welcome to my Study</h1>
        <p>Click to look around. WASD to move. Explore and interact with objects!</p>
    </div>

    <div id="crosshair"></div>
    <div id="tooltip"></div>

    <a href="index.html" id="back-link">‚Üê Back to main site</a>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

        // Scene setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1a1a2e);
        scene.fog = new THREE.Fog(0x1a1a2e, 1, 20);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 1.6, 3);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.body.appendChild(renderer.domElement);

        // Controls
        const controls = new PointerLockControls(camera, document.body);

        const info = document.getElementById('info');
        const crosshair = document.getElementById('crosshair');
        const tooltip = document.getElementById('tooltip');
        const loading = document.getElementById('loading');

        document.addEventListener('click', () => {
            if (!controls.isLocked) {
                controls.lock();
            }
        });

        controls.addEventListener('lock', () => {
            info.style.opacity = '0';
            crosshair.style.opacity = '1';
        });

        controls.addEventListener('unlock', () => {
            info.style.opacity = '1';
            crosshair.style.opacity = '0';
            tooltip.style.opacity = '0';
        });

        // Movement
        const velocity = new THREE.Vector3();
        const direction = new THREE.Vector3();
        let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false;

        document.addEventListener('keydown', (e) => {
            switch(e.code) {
                case 'KeyW': case 'ArrowUp': moveForward = true; break;
                case 'KeyS': case 'ArrowDown': moveBackward = true; break;
                case 'KeyA': case 'ArrowLeft': moveLeft = true; break;
                case 'KeyD': case 'ArrowRight': moveRight = true; break;
            }
        });

        document.addEventListener('keyup', (e) => {
            switch(e.code) {
                case 'KeyW': case 'ArrowUp': moveForward = false; break;
                case 'KeyS': case 'ArrowDown': moveBackward = false; break;
                case 'KeyA': case 'ArrowLeft': moveLeft = false; break;
                case 'KeyD': case 'ArrowRight': moveRight = false; break;
            }
        });

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x404060, 0.5);
        scene.add(ambientLight);

        // Warm ceiling light
        const ceilingLight = new THREE.PointLight(0xffeedd, 1, 15);
        ceilingLight.position.set(0, 2.8, 0);
        ceilingLight.castShadow = true;
        ceilingLight.shadow.mapSize.width = 1024;
        ceilingLight.shadow.mapSize.height = 1024;
        scene.add(ceilingLight);

        // Desk lamp light
        const deskLight = new THREE.SpotLight(0xffffee, 0.8, 5, Math.PI / 4, 0.5);
        deskLight.position.set(-3, 2.2, -3);
        deskLight.target.position.set(-3.5, 0.8, -3.5);
        deskLight.castShadow = true;
        scene.add(deskLight);
        scene.add(deskLight.target);

        // Materials
        const wallMaterial = new THREE.MeshStandardMaterial({
            color: 0x2d2d44,
            roughness: 0.9
        });
        const floorMaterial = new THREE.MeshStandardMaterial({
            color: 0x1a1a28,
            roughness: 0.8
        });
        const woodMaterial = new THREE.MeshStandardMaterial({
            color: 0x4a3728,
            roughness: 0.7
        });
        const bookMaterial1 = new THREE.MeshStandardMaterial({ color: 0x8b4513 });
        const bookMaterial2 = new THREE.MeshStandardMaterial({ color: 0x2e4a62 });
        const bookMaterial3 = new THREE.MeshStandardMaterial({ color: 0x4a2e4a });
        const bookMaterial4 = new THREE.MeshStandardMaterial({ color: 0x2e5a4a });
        const screenMaterial = new THREE.MeshStandardMaterial({
            color: 0x111122,
            emissive: 0x2563eb,
            emissiveIntensity: 0.3
        });

        // Room dimensions
        const roomWidth = 8;
        const roomHeight = 3.5;
        const roomDepth = 8;

        // Floor
        const floor = new THREE.Mesh(
            new THREE.PlaneGeometry(roomWidth, roomDepth),
            floorMaterial
        );
        floor.rotation.x = -Math.PI / 2;
        floor.receiveShadow = true;
        scene.add(floor);

        // Ceiling
        const ceiling = new THREE.Mesh(
            new THREE.PlaneGeometry(roomWidth, roomDepth),
            wallMaterial
        );
        ceiling.rotation.x = Math.PI / 2;
        ceiling.position.y = roomHeight;
        scene.add(ceiling);

        // Walls
        const wallBack = new THREE.Mesh(
            new THREE.PlaneGeometry(roomWidth, roomHeight),
            wallMaterial
        );
        wallBack.position.set(0, roomHeight/2, -roomDepth/2);
        wallBack.receiveShadow = true;
        scene.add(wallBack);

        const wallFront = new THREE.Mesh(
            new THREE.PlaneGeometry(roomWidth, roomHeight),
            wallMaterial
        );
        wallFront.position.set(0, roomHeight/2, roomDepth/2);
        wallFront.rotation.y = Math.PI;
        scene.add(wallFront);

        const wallLeft = new THREE.Mesh(
            new THREE.PlaneGeometry(roomDepth, roomHeight),
            wallMaterial
        );
        wallLeft.position.set(-roomWidth/2, roomHeight/2, 0);
        wallLeft.rotation.y = Math.PI / 2;
        wallLeft.receiveShadow = true;
        scene.add(wallLeft);

        const wallRight = new THREE.Mesh(
            new THREE.PlaneGeometry(roomDepth, roomHeight),
            wallMaterial
        );
        wallRight.position.set(roomWidth/2, roomHeight/2, 0);
        wallRight.rotation.y = -Math.PI / 2;
        scene.add(wallRight);

        // Interactive objects array
        const interactiveObjects = [];

        // ===== BOOKSHELF (Notes) =====
        function createBookshelf() {
            const group = new THREE.Group();

            // Shelf frame
            const frameGeo = new THREE.BoxGeometry(1.5, 2.2, 0.35);
            const frame = new THREE.Mesh(frameGeo, woodMaterial);
            frame.position.y = 1.1;
            frame.castShadow = true;
            frame.receiveShadow = true;
            group.add(frame);

            // Shelves
            for (let i = 0; i < 4; i++) {
                const shelf = new THREE.Mesh(
                    new THREE.BoxGeometry(1.4, 0.03, 0.32),
                    woodMaterial
                );
                shelf.position.set(0, 0.3 + i * 0.5, 0.02);
                group.add(shelf);
            }

            // Books
            const bookMaterials = [bookMaterial1, bookMaterial2, bookMaterial3, bookMaterial4];
            for (let row = 0; row < 3; row++) {
                let xPos = -0.55;
                for (let i = 0; i < 6; i++) {
                    const width = 0.08 + Math.random() * 0.08;
                    const height = 0.3 + Math.random() * 0.1;
                    const book = new THREE.Mesh(
                        new THREE.BoxGeometry(width, height, 0.22),
                        bookMaterials[Math.floor(Math.random() * bookMaterials.length)]
                    );
                    book.position.set(xPos + width/2, 0.45 + row * 0.5 + height/2, 0.02);
                    book.rotation.y = (Math.random() - 0.5) * 0.1;
                    book.castShadow = true;
                    group.add(book);
                    xPos += width + 0.02;
                }
            }

            group.position.set(3.5, 0, -3.5);
            group.rotation.y = -Math.PI / 4;

            group.userData = {
                type: 'interactive',
                name: 'Bookshelf',
                action: 'notes/index.html',
                tooltip: 'Click to browse Notes'
            };

            return group;
        }

        const bookshelf = createBookshelf();
        scene.add(bookshelf);
        interactiveObjects.push(bookshelf);

        // ===== DESK WITH COMPUTER (Projects) =====
        function createDesk() {
            const group = new THREE.Group();

            // Desk surface
            const deskTop = new THREE.Mesh(
                new THREE.BoxGeometry(1.8, 0.05, 0.9),
                woodMaterial
            );
            deskTop.position.y = 0.75;
            deskTop.castShadow = true;
            deskTop.receiveShadow = true;
            group.add(deskTop);

            // Legs
            const legGeo = new THREE.BoxGeometry(0.08, 0.75, 0.08);
            const positions = [[-0.8, 0.375, -0.35], [0.8, 0.375, -0.35], [-0.8, 0.375, 0.35], [0.8, 0.375, 0.35]];
            positions.forEach(pos => {
                const leg = new THREE.Mesh(legGeo, woodMaterial);
                leg.position.set(...pos);
                leg.castShadow = true;
                group.add(leg);
            });

            // Monitor
            const monitorStand = new THREE.Mesh(
                new THREE.BoxGeometry(0.15, 0.25, 0.1),
                new THREE.MeshStandardMaterial({ color: 0x222233 })
            );
            monitorStand.position.set(0, 0.9, -0.2);
            group.add(monitorStand);

            const monitor = new THREE.Mesh(
                new THREE.BoxGeometry(0.8, 0.5, 0.05),
                new THREE.MeshStandardMaterial({ color: 0x222233 })
            );
            monitor.position.set(0, 1.3, -0.25);
            monitor.castShadow = true;
            group.add(monitor);

            const screen = new THREE.Mesh(
                new THREE.PlaneGeometry(0.72, 0.42),
                screenMaterial
            );
            screen.position.set(0, 1.3, -0.22);
            group.add(screen);

            // Keyboard
            const keyboard = new THREE.Mesh(
                new THREE.BoxGeometry(0.4, 0.02, 0.15),
                new THREE.MeshStandardMaterial({ color: 0x333344 })
            );
            keyboard.position.set(0, 0.79, 0.15);
            group.add(keyboard);

            group.position.set(-3.2, 0, -3.2);
            group.rotation.y = Math.PI / 4;

            group.userData = {
                type: 'interactive',
                name: 'Computer',
                action: 'projects.html',
                tooltip: 'Click to view Projects'
            };

            return group;
        }

        const desk = createDesk();
        scene.add(desk);
        interactiveObjects.push(desk);

        // ===== PICTURE FRAME (About) =====
        function createPictureFrame() {
            const group = new THREE.Group();

            // Frame
            const frame = new THREE.Mesh(
                new THREE.BoxGeometry(0.8, 1, 0.05),
                woodMaterial
            );
            frame.castShadow = true;
            group.add(frame);

            // Picture (gradient-ish)
            const picture = new THREE.Mesh(
                new THREE.PlaneGeometry(0.65, 0.85),
                new THREE.MeshStandardMaterial({
                    color: 0x3a5a7c,
                    emissive: 0x1a2a3c,
                    emissiveIntensity: 0.1
                })
            );
            picture.position.z = 0.03;
            group.add(picture);

            // Silhouette (simple abstract person)
            const head = new THREE.Mesh(
                new THREE.CircleGeometry(0.1, 16),
                new THREE.MeshBasicMaterial({ color: 0x2a3a4c })
            );
            head.position.set(0, 0.15, 0.035);
            group.add(head);

            const body = new THREE.Mesh(
                new THREE.PlaneGeometry(0.25, 0.35),
                new THREE.MeshBasicMaterial({ color: 0x2a3a4c })
            );
            body.position.set(0, -0.2, 0.035);
            group.add(body);

            group.position.set(-3.9, 1.8, 0);
            group.rotation.y = Math.PI / 2;

            group.userData = {
                type: 'interactive',
                name: 'Portrait',
                action: 'about.html',
                tooltip: 'Click to learn About me'
            };

            return group;
        }

        const pictureFrame = createPictureFrame();
        scene.add(pictureFrame);
        interactiveObjects.push(pictureFrame);

        // ===== DOOR (Contact) =====
        function createDoor() {
            const group = new THREE.Group();

            // Door frame
            const doorFrame = new THREE.Mesh(
                new THREE.BoxGeometry(1.1, 2.3, 0.15),
                new THREE.MeshStandardMaterial({ color: 0x3d2817 })
            );
            doorFrame.position.y = 1.15;
            group.add(doorFrame);

            // Door
            const door = new THREE.Mesh(
                new THREE.BoxGeometry(0.9, 2.1, 0.08),
                new THREE.MeshStandardMaterial({ color: 0x5a4030 })
            );
            door.position.set(0, 1.1, 0.05);
            door.castShadow = true;
            group.add(door);

            // Door handle
            const handle = new THREE.Mesh(
                new THREE.BoxGeometry(0.15, 0.05, 0.08),
                new THREE.MeshStandardMaterial({ color: 0xc9a227, metalness: 0.8, roughness: 0.2 })
            );
            handle.position.set(0.3, 1.1, 0.12);
            group.add(handle);

            group.position.set(3.92, 0, 0);
            group.rotation.y = -Math.PI / 2;

            group.userData = {
                type: 'interactive',
                name: 'Door',
                action: 'contact.html',
                tooltip: 'Click to Contact me'
            };

            return group;
        }

        const door = createDoor();
        scene.add(door);
        interactiveObjects.push(door);

        // ===== ARMCHAIR =====
        function createArmchair() {
            const group = new THREE.Group();
            const chairMaterial = new THREE.MeshStandardMaterial({ color: 0x4a3040, roughness: 0.9 });

            // Seat
            const seat = new THREE.Mesh(new THREE.BoxGeometry(0.7, 0.15, 0.6), chairMaterial);
            seat.position.y = 0.4;
            seat.castShadow = true;
            group.add(seat);

            // Back
            const back = new THREE.Mesh(new THREE.BoxGeometry(0.7, 0.7, 0.12), chairMaterial);
            back.position.set(0, 0.8, -0.25);
            back.castShadow = true;
            group.add(back);

            // Arms
            const armGeo = new THREE.BoxGeometry(0.12, 0.35, 0.5);
            const leftArm = new THREE.Mesh(armGeo, chairMaterial);
            leftArm.position.set(-0.35, 0.55, 0);
            group.add(leftArm);
            const rightArm = new THREE.Mesh(armGeo, chairMaterial);
            rightArm.position.set(0.35, 0.55, 0);
            group.add(rightArm);

            // Legs
            const legGeo = new THREE.CylinderGeometry(0.04, 0.04, 0.25);
            const legMat = new THREE.MeshStandardMaterial({ color: 0x2a1a15 });
            [[-0.25, 0.125, 0.2], [0.25, 0.125, 0.2], [-0.25, 0.125, -0.2], [0.25, 0.125, -0.2]].forEach(pos => {
                const leg = new THREE.Mesh(legGeo, legMat);
                leg.position.set(...pos);
                group.add(leg);
            });

            group.position.set(0, 0, -2);
            group.rotation.y = Math.PI;

            return group;
        }

        scene.add(createArmchair());

        // ===== RUG =====
        const rug = new THREE.Mesh(
            new THREE.CircleGeometry(1.5, 32),
            new THREE.MeshStandardMaterial({ color: 0x3d2a4a, roughness: 1 })
        );
        rug.rotation.x = -Math.PI / 2;
        rug.position.set(0, 0.01, -1);
        scene.add(rug);

        // ===== CEILING LAMP =====
        const lampShade = new THREE.Mesh(
            new THREE.ConeGeometry(0.3, 0.2, 16, 1, true),
            new THREE.MeshStandardMaterial({ color: 0x888877, side: THREE.DoubleSide })
        );
        lampShade.position.set(0, 2.9, 0);
        lampShade.rotation.x = Math.PI;
        scene.add(lampShade);

        // Raycaster for interaction
        const raycaster = new THREE.Raycaster();
        raycaster.far = 4;
        const mouse = new THREE.Vector2(0, 0);

        let currentIntersected = null;

        function checkInteraction() {
            raycaster.setFromCamera(mouse, camera);

            const allMeshes = [];
            interactiveObjects.forEach(obj => {
                obj.traverse(child => {
                    if (child.isMesh) {
                        child.userData.parentGroup = obj;
                        allMeshes.push(child);
                    }
                });
            });

            const intersects = raycaster.intersectObjects(allMeshes);

            if (intersects.length > 0) {
                const obj = intersects[0].object.userData.parentGroup || intersects[0].object;
                if (obj.userData.type === 'interactive') {
                    currentIntersected = obj;
                    tooltip.textContent = obj.userData.tooltip;
                    tooltip.style.opacity = '1';
                    document.body.style.cursor = 'pointer';
                    return;
                }
            }

            currentIntersected = null;
            tooltip.style.opacity = '0';
            document.body.style.cursor = 'default';
        }

        // Click to interact
        document.addEventListener('click', () => {
            if (controls.isLocked && currentIntersected) {
                window.location.href = currentIntersected.userData.action;
            }
        });

        // Animation loop
        let prevTime = performance.now();

        function animate() {
            requestAnimationFrame(animate);

            const time = performance.now();
            const delta = (time - prevTime) / 1000;

            if (controls.isLocked) {
                // Movement with collision bounds
                velocity.x -= velocity.x * 8.0 * delta;
                velocity.z -= velocity.z * 8.0 * delta;

                direction.z = Number(moveForward) - Number(moveBackward);
                direction.x = Number(moveRight) - Number(moveLeft);
                direction.normalize();

                if (moveForward || moveBackward) velocity.z -= direction.z * 15.0 * delta;
                if (moveLeft || moveRight) velocity.x -= direction.x * 15.0 * delta;

                controls.moveRight(-velocity.x * delta);
                controls.moveForward(-velocity.z * delta);

                // Keep player in bounds
                const bounds = 3.3;
                camera.position.x = Math.max(-bounds, Math.min(bounds, camera.position.x));
                camera.position.z = Math.max(-bounds, Math.min(bounds, camera.position.z));

                checkInteraction();
            }

            prevTime = time;
            renderer.render(scene, camera);
        }

        // Handle resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Hide loading screen
        setTimeout(() => {
            loading.style.opacity = '0';
            setTimeout(() => loading.style.display = 'none', 500);
        }, 1000);

        animate();
    </script>
</body>
</html>
